<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="Join CharlestonHacks for transformative hackathons and tech meetups in Charleston, SC. Build, learn, and connect with local innovators.">
    <meta property="og:title" content="CharlestonHacks | Charleston Hackathons & Tech Events" />
    <meta property="og:description" content="CharlestonHacks promotes tech events including the AI Film Fest. Join us for exciting events and stay updated." />
    <meta property="og:image" content="images/reactiveh.png" />
    <meta property="og:url" content="https://charlestonhacks.com" />
    <meta name="twitter:card" content="summary_large_image" />
    <title>CharlestonHacks - Home</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="manifest" href="manifest.json" />

    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://hvmotpzhliufzomewzfl.supabase.co">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="achievements" class="achievements" aria-live="polite"></div>
    <div class="container">
        <header class="header">
            <h1>Innovation Engine</h1>
            <p>Connect, Build, and Innovate Together</p>
        </header>
        <main class="panel">
            <section id="matchmaking-section">
                <h2 class="section-title">
                    <i class="fas fa-user-plus" aria-hidden="true"></i> Create Your Profile
                </h2>
                <form id="skills-form">
                    <div class="input-container">
                        <input type="text" id="first-name" placeholder="First Name" required aria-label="First Name">
                        <input type="text" id="last-name" placeholder="Last Name" required aria-label="Last Name">
                        <input type="email" name="_replyto" id="email" placeholder="Email" required aria-label="Email">
                        <label for="skills-input">Professional Skills (comma separated)</label>
                        <input type="text" id="skills-input" placeholder="e.g. aws, fullstack, java, python" required autocomplete="off" aria-describedby="autocomplete-skills-input">
                        <div id="skills-proficiency-container"></div>
                        <div id="autocomplete-skills-input" class="autocomplete-box"></div>
                        <label for="photo-input">Upload Your Photo</label>
                        <input type="file" id="photo-input" accept="image/*" required aria-label="Upload Photo">
                        <img id="preview" src="#" alt="Image Preview" class="image-preview" />
                        <label for="bio-input">Short Bio <span class="optional-text">(Optional)</span></label>
                        <input type="text" id="bio-input" placeholder="Tell us about yourself" maxlength="120" aria-label="Short Bio">
                        <label for="availability-input">Current Availability</label>
                        <select id="availability-input" aria-label="Current Availability">
                            <option value="Available">Available</option>
                            <option value="Busy">Busy</option>
                            <option value="Not Looking">Not Looking</option>
                        </select>
                        <button type="submit">Register & Subscribe</button>
                    </div>
                    <div class="profile-bar" id="profile-bar"><div class="profile-bar-inner"></div></div>
                    <div id="profile-progress-msg" class="profile-incomplete"></div>
                </form>
                <p id="success-message" class="success-message" role="status" style="display:none;">Added Successfully!</p>
            </section>

            <div class="leaderboard" id="leaderboard-section" style="display:none;">
                <h2>Top Endorsed Skills</h2>
                <div id="leaderboard-rows"></div>
            </div>

            <h2 class="section-title">
                <i class="fas fa-search" aria-hidden="true"></i> Individual Search
            </h2>
            <div class="input-container">
                <label for="teamSkillsInput">Required Skills</label>
                <input type="text" id="teamSkillsInput" placeholder="e.g. aws, fullstack, java, python" autocomplete="off" aria-describedby="autocomplete-team-skills">
                <div id="autocomplete-team-skills" class="autocomplete-box"></div>
                <button id="find-team-btn" type="button">Get People</button> <br> <br>
                <label for="nameInput">Search by First/Last Name</label>
                <input type="text" id="nameInput" placeholder="e.g. John, Doug, Will, Dave" autocomplete="off">
                <button id="search-name-btn" type="button">Find by Name</button>
            </div>
            <div id="matchNotification" class="notification match-notification" style="display: none;"></div>
            <div id="noResults" class="notification no-results-notification" style="display: none;"></div>
            <div id="cardContainer" class="card-container" role="list" aria-label="Matching team members"></div>

            <h2 class="section-title">
                <i class="fas fa-users" aria-hidden="true"></i> Team Builder
            </h2>
            <div class="input-container">
                <p class="instructions">
                    Letâ€™s build your team. Enter required skills and number of people needed.
                </p>
                <label for="team-skills-input">Required Skills</label>
                <input type="text" id="team-skills-input" placeholder="e.g. aws, fullstack, java, python" autocomplete="off" aria-describedby="autocomplete-teams-skills"/>
                <div id="autocomplete-teams-skills" class="autocomplete-box"></div>
                <label for="teamSize">Team Size</label>
                <input type="number" id="teamSize" placeholder="e.g. 3" min="1" max="6" aria-label="Team Size"/>
                <button onclick="buildBestTeam()">Build Team</button>
            </div>
            <div class="card-container" id="bestTeamContainer" role="list" aria-label="Best matched team"></div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
    <script src="main.js" defer></script>
</body>
</html>
    <!-- Achievements -->
    <div id="achievements" class="achievements" aria-live="polite"></div>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Innovation Engine</h1>
            <p>Connect, Build, and Innovate Together</p>
        </header>
        <!-- Main Panel -->
        <main class="panel">
            <!-- ========== TEAM BUILDER FUNCTIONALITY ========== -->
            <section id="matchmaking-section">
                <h2 style="color:#FFD700; text-align: left; margin-bottom: 20px; display: inline-block;">
  <i class="fas fa-user-plus" style="margin-right: 8px;"></i> Create Your Profile
</h2>
                <form id="skills-form">
                    <div class="input-container">
                        <input type="text" id="first-name" placeholder="First Name" required>
                        <input type="text" id="last-name" placeholder="Last Name" required>
                        <input type="email" name="_replyto" id="email" placeholder="Email" required>
                        <label>Professional Skills (comma separated)</label>
                        <input type="text" id="skills-input" placeholder="e.g. aws, fullstack, java, python" required autocomplete="off">
                        <div id="skills-proficiency-container"></div>
                        <div id="autocomplete-skills-input" style="position:absolute; z-index:1000; background:#fff; color:#000; border:1px solid #ccc; display:none;"></div>
                        <label>Upload Your Photo</label>
                        <input type="file" id="photo-input" accept="image/*" required>
                        <img id="preview" src="#" alt="Image Preview" style="display: none; max-width: 120px; margin-top: 10px; border-radius: 5px; border: 2px solid #FFD700;" />
                        <label>Short Bio <span style="color:#888">(Optional)</span></label>
                        <input type="text" id="bio-input" placeholder="Tell us about yourself" maxlength="120">
                        <label>Current Availability</label>
                        <select id="availability-input">
                            <option value="Available">Available</option>
                            <option value="Busy">Busy</option>
                            <option value="Not Looking">Not Looking</option>
                        </select>
                        <button type="submit">Register & Subscribe</button>
                    </div>
                    <div class="profile-bar" id="profile-bar"><div class="profile-bar-inner" style="width:0%"></div></div>
                    <div id="profile-progress-msg" class="profile-incomplete"></div>
                </form>
                <p id="success-message" style="display:none; color: green;">Added Successfully!</p>
            </section>

            <!-- Leaderboard Section -->
            <div class="leaderboard" id="leaderboard-section" style="display:none;">
                <h2>Top Endorsed Skills</h2>
                <div id="leaderboard-rows"></div>
            </div>

            <!-- Individual Search -->
              <h2 style="color:#FFD700; text-align: left; margin-bottom: 20px; display: inline-block;">
  <i class="fas fa-search" style="margin-right: 8px;"></i> Individual Search
</h2>
            <div class="input-container">
                <label>Required Skills</label>
                <input type="text" id="teamSkillsInput" placeholder="e.g. aws, fullstack, java, python" autocomplete="off">
                <div id="autocomplete-team-skills" style="position:absolute; z-index:1000; background:#fff; color:#000; border:1px solid #ccc; display:none;"></div>
                <button id="find-team-btn" type="button">Get People</button> <br> <br>
                <label>Search by First/Last Name</label>
                <input type="text" id="nameInput" placeholder="e.g. John, Doug, Will, Dave" autocomplete="off">
                <button id="search-name-btn" type="button">Find by Name</button>
            </div>
            <div id="matchNotification" style="margin-bottom: 6px; color: gold; display: none;"></div>
            <div id="noResults" style="margin-bottom: 6px; color: red; display: none;"></div>
            <div id="cardContainer" class="card-container" role="list" aria-label="Matching team members"></div>

            <!-- Team Builder -->
                <h2 style="color:#FFD700; text-align: left; margin-bottom: 20px; display: inline-block;">
  <i class="fas fa-users" style="margin-right: 8px;"></i> Team Builder
</h2>
            <div class="input-container">
                <p class="instructions" style="max-width: 600px; margin-bottom: 10px;">
                    Letâ€™s build your team. Enter required skills and number of people needed.
                </p>
                <label>Required Skills</label>
                <input type="text" id="team-skills-input" placeholder="e.g. aws, fullstack, java, python" autocomplete="off"/>
                <div id="autocomplete-teams-skills" style="position:absolute; z-index:1000; background:#fff; color:#000; border:1px solid #ccc; display:none;"></div>
                <label>Team Size</label>
                <input type="number" id="teamSize" placeholder="e.g. 3" min="1" max="6"/>
                <button onclick="buildBestTeam()">Build Team</button>
            </div>
            <div class="card-container" id="bestTeamContainer" role="list" aria-label="Best matched team"></div>
        </main>
    
    </div>
    <!-- ========== TEAM BUILDER SCRIPTS (from original) ========== -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    // ----------- TEAM BUILDER JS LOGIC (as in your original) -----------
    const supabaseUrl = 'https://hvmotpzhliufzomewzfl.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2bW90cHpobGl1ZnpvbWV3emZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI1NzY2NDUsImV4cCI6MjA1ODE1MjY0NX0.foHTGZVtRjFvxzDfMf1dpp0Zw4XFfD-FPZK-zRnjc6s';
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    // ---------------------- PROFILE BAR/COMPLETION ----------------------
    function updateProfileProgress() {
        const fields = [
            document.getElementById("first-name").value.trim(),
            document.getElementById("last-name").value.trim(),
            document.getElementById("email").value.trim(),
            document.getElementById("skills-input").value.trim(),
            document.getElementById("photo-input").value,
            document.getElementById("availability-input").value,
        ];
        let filled = fields.filter(Boolean).length;
        let percent = Math.floor((filled / fields.length) * 100);
        document.querySelector("#profile-bar .profile-bar-inner").style.width = percent + "%";
        let msg = percent == 100 ? "Profile Complete!" : "Profile incomplete, fill all fields";
        document.getElementById("profile-progress-msg").textContent = msg;
        document.getElementById("profile-progress-msg").className = percent == 100 ? "profile-complete" : "profile-incomplete";
    }
    document.querySelectorAll("#skills-form input, #skills-form select").forEach(el => el.addEventListener("input", updateProfileProgress));

    // ---------------------- SKILL PROFICIENCY LOGIC ----------------------
    const skillProficiencies = {};
    document.getElementById("skills-input").addEventListener('input', function() {
        const skills = this.value.split(',').map(s => s.trim()).filter(Boolean);
        const container = document.getElementById('skills-proficiency-container');
        container.innerHTML = '';
        skills.forEach(skill => {
            if (!skill) return;
            if (!(skill in skillProficiencies)) skillProficiencies[skill] = "Intermediate";
            container.innerHTML += `
                <div style="margin-bottom: 7px;">
                <span style="color:#FFD700;">${skill}</span>
                <select class="proficiency-select" data-skill="${skill}">
                <option value="Beginner" ${skillProficiencies[skill]=="Beginner"?"selected":""}>Beginner</option>
                <option value="Intermediate" ${skillProficiencies[skill]=="Intermediate"?"selected":""}>Intermediate</option>
                <option value="Expert" ${skillProficiencies[skill]=="Expert"?"selected":""}>Expert</option>
                </select>
                </div>
            `;
        });
        // Update model on change
        document.querySelectorAll('.proficiency-select').forEach(sel => {
            sel.addEventListener('change', function() { skillProficiencies[this.dataset.skill] = this.value; });
        });
    });

    // ------------------ IMAGE PREVIEW -------------------
    document.getElementById('photo-input').addEventListener('change', function(){
        const file = this.files[0];
        const preview = document.getElementById('preview');
        if(file){
            const reader = new FileReader();
            reader.onload = e => { preview.src = e.target.result; preview.style.display = 'block'; };
            reader.readAsDataURL(file);
        }
    });

    // ----------------- AUTOCOMPLETE (skills) -------------
    let dynamicSkills = [];
    async function fetchUniqueSkills() {
        try {
            const { data, error } = await supabaseClient.from('skills').select('skills');
            if (error) throw error;
            dynamicSkills = [...new Set(data.flatMap(item => item.skills.split(',').map(skill => skill.trim().toLowerCase())))];
        } catch (error) { dynamicSkills = []; }
    }
    function setupAutocomplete(inputId, boxId) {
        const input = document.getElementById(inputId);
        const box = document.getElementById(boxId);
        input.addEventListener('input', () => {
            const userInput = input.value.toLowerCase().trim().split(',').pop().trim();
            box.innerHTML = ''; if (!userInput || !dynamicSkills.length) { box.style.display = 'none'; return; }
            const matches = dynamicSkills.filter(skill => skill.includes(userInput)).slice(0, 10);
            if (!matches.length) { box.style.display = 'none'; return; }
            matches.forEach(skill => {
                const item = document.createElement('div');
                item.textContent = skill; item.style.padding = '5px'; item.style.cursor = 'pointer';
                item.onclick = () => {
                    const parts = input.value.split(','); parts.pop(); parts.push(skill);
                    input.value = parts.map(p => p.trim()).join(', ');
                    box.innerHTML = ''; box.style.display = 'none';
                    input.dispatchEvent(new Event("input"));
                };
                box.appendChild(item);
            });
            const rect = input.getBoundingClientRect();
            box.style.left = `${rect.left + window.scrollX}px`;
            box.style.top = `${rect.bottom + window.scrollY}px`;
            box.style.width = `${rect.width}px`;
            box.style.display = 'block';
        });
        document.addEventListener('click', (e) => { if (!box.contains(e.target) && e.target !== input) box.style.display = 'none'; });
    }
    document.addEventListener('DOMContentLoaded', async () => {
        await fetchUniqueSkills();
        setupAutocomplete('skills-input','autocomplete-skills-input');
        setupAutocomplete('teamSkillsInput','autocomplete-team-skills');
        setupAutocomplete('team-skills-input','autocomplete-teams-skills');
        loadLeaderboard();
    });

    // ------------------ PROFILE SUBMIT ---------------------
    document.getElementById('skills-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const firstName = document.getElementById('first-name').value.trim();
        const lastName = document.getElementById('last-name').value.trim();
        const email = document.getElementById('email').value.trim();
        const rawSkills = document.getElementById('skills-input').value.trim().replace(/,\s*$/, '');
        const skillsArr = rawSkills.split(',').map(s => s.trim()).filter(Boolean);
        const profs = skillsArr.map(skill => skillProficiencies[skill] || "Intermediate");
        const skillsWithProfs = skillsArr.map((skill,i) => `${skill}(${profs[i]})`).join(',');
        const bio = document.getElementById('bio-input').value.trim();
        const avail = document.getElementById('availability-input').value;
        const photoInput = document.getElementById('photo-input').files[0];
        if (!photoInput) { alert('Please select an image.'); return; }
        const fileExt = photoInput.name.split('.').pop();
        const fileName = `${Date.now()}.${fileExt}`;
        const { error: uploadError } = await supabaseClient.storage.from('hacksbucket').upload(fileName, photoInput);
        if (uploadError) { alert('Upload error: ' + uploadError.message); return; }
        const imageUrl = `${supabaseUrl}/storage/v1/object/public/hacksbucket/${fileName}`;
        const { error } = await supabaseClient.from('skills').insert({
            first_name: firstName, last_name: lastName, email: email, skills: skillsWithProfs,
            image_url: imageUrl, Bio: bio, Availability: avail, endorsements: "", created_at: new Date().toISOString()
        });
        if (error) { alert('Error inserting data: ' + error.message); } 
        else { alert('Registration successful!'); document.getElementById('skills-form').reset();
            document.getElementById("profile-bar").querySelector(".profile-bar-inner").style.width = "0%";
            document.getElementById("profile-progress-msg").textContent = "";
            fetchUniqueSkills();
            loadLeaderboard();
        }
    });

    // ----------- INDIVIDUAL SEARCH -------------
    document.getElementById('find-team-btn').addEventListener('click', findMatchingUsers);
    async function findMatchingUsers() {
        const skillsInput = document.getElementById('teamSkillsInput').value.trim();
        const cardContainer = document.getElementById('cardContainer');
        cardContainer.innerHTML = '';
        if (!skillsInput) { alert('Please enter at least one skill.'); return; }
        const requiredSkills = skillsInput.toLowerCase().split(',').map(skill => skill.trim());
        const { data, error } = await supabaseClient.from('skills').select('*');
        if (error) { cardContainer.innerHTML = '<span style="color:red;">Error fetching data.</span>'; return; }
        function isFuzzyMatch(userSkill, requiredSkill) {
            userSkill = userSkill.toLowerCase(); requiredSkill = requiredSkill.toLowerCase();
            return userSkill.includes(requiredSkill) || requiredSkill.includes(userSkill) || userSkill === requiredSkill;
        }
        const matchedUsers = data.filter(user => {
            const userSkillsRaw = user.skills.split(',').map(s => s.trim());
            return requiredSkills.every(skill =>
                userSkillsRaw.some(us => isFuzzyMatch(us.replace(/\(.*?\)/,''), skill))
            );
        });
        renderUserCards(matchedUsers, cardContainer);
    }

    // ----------- SEARCH BY NAME -------------
    document.getElementById('search-name-btn').addEventListener('click', searchUserByName);
    async function searchUserByName() {
        const nameInput = document.getElementById('nameInput').value.trim().toLowerCase();
        const cardContainer = document.getElementById('cardContainer');
        cardContainer.innerHTML = '';
        if (!nameInput) { alert('Please enter a name.'); return; }
        const { data, error } = await supabaseClient.from('skills').select('*');
        if (error) { cardContainer.innerHTML = '<span style="color:red;">Error fetching data.</span>'; return; }
        const matchedUsers = data.filter(user => {
            const fullName = `${user.first_name} ${user.last_name}`.toLowerCase();
            return fullName.includes(nameInput) || user.first_name.toLowerCase().includes(nameInput) || user.last_name.toLowerCase().includes(nameInput);
        });
        renderUserCards(matchedUsers, cardContainer);
    }

    // ----------- TEAM BUILDER -------------
    window.buildBestTeam = async function() {
        const skillInputRaw = document.getElementById('team-skills-input').value;
        const teamSize = parseInt(document.getElementById('teamSize').value, 10);
        const container = document.getElementById('bestTeamContainer');
        container.innerHTML = '';
        const skillInput = skillInputRaw.toLowerCase().split(',').map(s => s.trim()).filter(Boolean);
        if (!skillInput.length || isNaN(teamSize) || teamSize < 1) { alert('Enter skills & team size.'); return; }
        const { data: users, error } = await supabaseClient.from('skills').select('*');
        if (error || !users) { container.innerHTML = '<span style="color:white;">Error loading users.</span>'; return; }
        // Score by how many required skills are matched
        const scored = users
            .map(user => {
                const userSkillsRaw = user.skills.split(',').map(s => s.trim());
                const matchingSkills = skillInput.filter(skill =>
                    userSkillsRaw.some(us => us.replace(/\(.*?\)/,'').toLowerCase().includes(skill))
                );
                return matchingSkills.length ? {...user, matchingSkills, matchCount: matchingSkills.length} : null;
            })
            .filter(Boolean)
            .sort((a,b) => b.matchCount-a.matchCount)
            .slice(0, teamSize);
        renderUserCards(scored, container);
    };

    // ----------- USER CARD RENDERING, ENDORSEMENTS, BADGES, STATUS -------------
    async function renderUserCards(users, container) {
        if (!users.length) { container.innerHTML = '<span style="color:#FF6B6B;">No matching users found.</span>'; return; }
       // âœ… Utility: Clean availability values
   const cleanAvailability = (value) => {
    // Handle true null or undefined
    if (value === null || value === undefined) return 'Unavailable';
    // Force string type
    if (typeof value !== 'string') return 'Unavailable';
    // Trim spaces
    const trimmed = value.trim();
    // Handle empty strings and literal "null"
    if (trimmed === '' || trimmed.toLowerCase() === 'null') return 'Unavailable';
    // Capitalize first letter
    return trimmed.charAt(0).toUpperCase() + trimmed.slice(1);
};
        // For demo: LocalStorage for userId, and endorsements
        let myEmail = localStorage.getItem("demo_user_email") || prompt("Enter your email for endorsements:");
        localStorage.setItem("demo_user_email", myEmail);
        for (let user of users) {
            // Skill badges
            let skillBadges = user.skills.split(',').map(skill => {
                const match = skill.match(/(.*?)\((.*?)\)/);
                let label = match ? match[1] : skill, prof = match ? match[2] : "Intermediate";
                return `<span class="skill-tag">${label} <span style="font-size:0.8em;opacity:.7;">[${prof}]</span></span>`;
            }).join(' ');
            // Endorsements
            let endorsements = {};
            try { endorsements = user.endorsements ? JSON.parse(user.endorsements) : {}; } catch {}
            container.innerHTML += `
                <div class="team-member-card">
                    ${user.image_url ? `<img src="${user.image_url}" alt="${user.first_name}" />` : ''}
                    <div class="member-name">${user.first_name} ${user.last_name}</div>
                    ${user.bio ? `<div style="color:#FFD700;font-size:.96em;margin:3px 0;">${user.bio}</div>` : ''}
                    <div class="user-status">
  Status: ${cleanAvailability(user.Availability)}
</div>
                    <div class="profile-section">${skillBadges}</div>
                    <div class="profile-section">
                        ${Object.keys(endorsements).length ? Object.entries(endorsements).map(([skill, count]) =>
                            `<span style="color:#FFD700;">${skill}: <span class="endorsements">${count} <i class="fa fa-thumbs-up"></i></span></span>`
                        ).join(' | ') : '<span style="color:#888;">No endorsements yet</span>'}
                    </div>
                    <button class="endorse-btn" ${user.email===myEmail?'disabled':''}
                        onclick="endorseSkill('${user.email}')">+ Endorse</button>
                </div>
            `;
        }
    }
    // ----------- ENDORSE FUNCTION -------------
    window.endorseSkill = async function(email) {
        let myEmail = localStorage.getItem("demo_user_email");
        if (!myEmail) return alert("Enter your email above and reload.");
        // For demo, fetch user, increment first skill endorsement
        const { data, error } = await supabaseClient.from('skills').select('*').eq('email',email);
        if (error || !data || !data.length) return alert("User not found");
        let user = data[0];
        let endorsements = {};
        try { endorsements = user.endorsements ? JSON.parse(user.endorsements) : {}; } catch {}
        let skill = user.skills.split(',')[0].replace(/\(.*?\)/,'');
        endorsements[skill] = (endorsements[skill]||0)+1;
        await supabaseClient.from('skills').update({endorsements: JSON.stringify(endorsements)}).eq('email',email);
        alert("Endorsed! Refresh to see update.");
        loadLeaderboard();
    };

    // ----------- LEADERBOARD -------------
    async function loadLeaderboard() {
        const { data, error } = await supabaseClient.from('skills').select('*');
        if (error || !data) { document.getElementById('leaderboard-section').style.display='none'; return; }
        // Aggregate all endorsements across skills/users
        let aggregate = {};
        for (let user of data) {
            let end = {};
            try { end = user.endorsements ? JSON.parse(user.endorsements) : {}; } catch {}
            for (let [skill, count] of Object.entries(end)) {
                aggregate[skill] = (aggregate[skill]||0) + count;
            }
        }
        // Top 5
        let top = Object.entries(aggregate).sort((a,b)=>b[1]-a[1]).slice(0,5);
        // const rows = top.length ? top.map(([skill,count],i)=>`
        //     <div class="leaderboard-row">
        //         <span class="leaderboard-rank">#${i+1}</span>
        //         <span class="leaderboard-name">${skill}</span>
        //         <span class="leaderboard-skill">${count} <i class="fa fa-thumbs-up"></i></span>
        //     </div>
        // `).join('') : '<div>No endorsements yet.</div>';
        document.getElementById('leaderboard-section').style.display = top.length?'block':'none';
        document.getElementById('leaderboard-rows').innerHTML = rows;
    }
    </script>
    <!-- ========== END TEAM BUILDER ========== -->
    <script>
    // ... Existing CharlestonHacks scripts for progress, achievements, countdown, etc. ...
    // --- Achievements/Progress/Audio config ---
    const AppState = {
        discoveredCards: new Set(),
        achievements: [],
    };
    const CONFIG = {
        countdown: {
            targetDate: "June 28, 2025 00:00:00",
            completedMessage: "Next Event Soon!",
        },
        achievements: [
            { id: 'first_flip', name: 'Card Flipper', description: 'Flipped your first card!' },
            { id: 'explorer', name: 'Explorer', description: 'Discovered 2 sections!' },
            { id: 'completionist', name: 'Completionist', description: 'Found all sections!' },
            { id: 'social_butterfly', name: 'Social Butterfly', description: 'Clicked a social link!' }
        ],
        cards: [
            { id: 'main', name: 'CharlestonHacks', image: 'images/hsoftest.png' },
            { id: 'info', name: 'Information', image: 'images/yellowscullcard.png' },
            { id: 'innovation', name: 'Innovation Engine', image: 'images/redscullcard.png' },
            { id: 'news', name: 'News & Updates', image: 'images/Descartes.png' },
            { id: 'people', name: 'Community', image: 'images/Alexandor.png' }
        ],
        audio: {
            cardflip: 'assets/atmospherel.m4a',
            keys: 'assets/keys.m4a',
            chime: 'assets/chime.mp3'
        }
    };
    // --- Audio Controller (v1: synthetic fallback, v2: mp3 support) ---
    const AudioController = {
        preloaded: false,
        context: null,
        sounds: new Map(),
        preloadAudio() {
            if (this.preloaded) return;
            Object.keys(CONFIG.audio).forEach(key => {
                const src = CONFIG.audio[key];
                if (src) new Audio(src);
            });
            this.preloaded = true;
        },
        async init() {
            if (window.AudioContext || window.webkitAudioContext) {
                try {
                    this.context = new (window.AudioContext || window.webkitAudioContext)();
                    this.createSounds();
                } catch (error) { }
            }
        },
        createSounds() {
            // Synthetic fallback for button/achievement/flip (short "chimes")
            if (!this.context) return;
            this.sounds.set('flip', this.createTone(800, 0.1));
            this.sounds.set('click', this.createTone(1000, 0.05));
            this.sounds.set('achievement', this.createTone(1200, 0.2));
            this.sounds.set('chime', this.createTone(700, 0.12));
        },
        createTone(frequency, duration) {
            if (!this.context) return null;
            const sampleRate = this.context.sampleRate;
            const buffer = this.context.createBuffer(1, sampleRate * duration, sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < buffer.length; i++) {
                data[i] = Math.sin(2 * Math.PI * frequency * i / sampleRate) * 0.14;
            }
            return buffer;
        },
        playSound(soundKey) {
            // Play mp3 if available, else synthetic
            const soundSrc = CONFIG.audio[soundKey];
            if (soundSrc) {
                const audio = new Audio(soundSrc);
                audio.volume = 0.20;
                audio.play().catch(()=>{});
                return;
            }
            if (this.context && this.sounds.has(soundKey)) {
                const source = this.context.createBufferSource();
                source.buffer = this.sounds.get(soundKey);
                source.connect(this.context.destination);
                source.start();
            }
        }
    };
    // --- Progress & Achievements ---
    const ProgressController = {
        update() {
            const progress = (AppState.discoveredCards.size / 4) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `Exploration Progress: ${AppState.discoveredCards.size}/4 areas discovered`;
            if (AppState.discoveredCards.size === 2 && !AppState.achievements.includes('explorer')) {
                AchievementController.unlock('explorer');
            }
            if (AppState.discoveredCards.size === 4 && !AppState.achievements.includes('completionist')) {
                AchievementController.unlock('completionist');
            }
        }
    };
    const AchievementController = {
        unlock(achievementId) {
            if (AppState.achievements.includes(achievementId)) return;
            AppState.achievements.push(achievementId);
            const achievement = CONFIG.achievements.find(a => a.id === achievementId);
            if (!achievement) return;
            this.showAchievement(achievement);
            AudioController.playSound('chime');
            if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
        },
        showAchievement(achievement) {
            const container = document.getElementById('achievements');
            const element = document.createElement('div');
            element.className = 'achievement';
            element.innerHTML = `<strong>${achievement.name}</strong><br><small>${achievement.description}</small>`;
            container.appendChild(element);
            setTimeout(() => element.classList.add('show'), 100);
            setTimeout(() => { element.style.transform = 'translateX(300px)'; setTimeout(()=>element.remove(), 300); }, 3000);
        }
    };
    // --- Countdown Timer ---
    const CountdownController = {
        interval: null,
        init() {
            this.start();
        },
        start() {
            const countDownDate = new Date(CONFIG.countdown.targetDate).getTime();
            const countdownElement = document.getElementById('countdown');
            this.interval = setInterval(() => {
                const now = new Date().getTime();
                const distance = countDownDate - now;
                if (distance < 0) {
                    countdownElement.textContent = CONFIG.countdown.completedMessage;
                    clearInterval(this.interval);
                    return;
                }
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                countdownElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }, 1000);
        }
    };
    // --- Social Links Achievement ---
    function addSocialLinkAchievement() {
        document.querySelectorAll('.icons-container a').forEach(link => {
            link.addEventListener('click', () => {
                if (!AppState.achievements.includes('social_butterfly')) AchievementController.unlock('social_butterfly');
                AudioController.playSound('chime');
            });
        });
    }
    // --- Loading Screen ---
    function hideLoading() {
        const loadingScreen = document.getElementById('loadingScreen');
        loadingScreen.classList.add('hidden');
        setTimeout(() => loadingScreen.remove(), 500);
    }
    // --- App Init ---
    (async function AppInit() {
        await AudioController.init();
        addSocialLinkAchievement();
        CountdownController.init();
        AppState.discoveredCards.add('main');
        ProgressController.update();
        setTimeout(hideLoading, 1200);
    })();
    </script>
</body>
</html>
