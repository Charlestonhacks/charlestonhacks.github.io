<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <title>CharlestonHacks Matching Game</title>
 
</head>
<body>
<div id="logo" style="cursor: pointer;">
    <img src="images/about us.webp" alt="About Us Logo" class="logo">
</div>

<div class="stats">
    <span id="timer">Time: 0s</span>
    <span id="moves">Moves: 0</span>
</div>

<div class="game-container" id="game-container"></div>

<div class="backstory" id="backstory"></div>

<!-- Victory Modal -->
<div class="modal-overlay" id="victory-modal">
    <div class="modal-content">
        <button class="modal-close" id="modal-close-btn" aria-label="Close Modal">&times;</button>
        <h2>Congratulations!</h2>
        <p id="victory-message"></p>
        <button class="modal-btn" id="play-again-btn">Play Again</button>
        <button class="modal-btn" id="profiles-btn">View Team Profiles</button>
    </div>
</div>

<div id="video-container">
    <button id="close-video">X</button>
    <video id="video" controls muted>
        <source id="video-source" type="video/mp4">
    </video>
</div>

<footer>
    <ul class="footer-icons">
        <li><a href="https://www.instagram.com/charlestonhacks/" target="_blank" rel="noopener" title="Instagram">
            <i class="fab fa-instagram"></i>
        </a></li>
        <li><a href="mailto:hello@charlestonhacks.com" title="Email">
            <i class="fas fa-envelope"></i>
        </a></li>
        <li><a href="https://www.linkedin.com/company/charlestonhacks" target="_blank" rel="noopener" title="LinkedIn">
            <i class="fab fa-linkedin"></i>
        </a></li>
        <li><a href="https://twitter.com/Descart84114619" target="_blank" rel="noopener" title="Twitter">
            <i class="fab fa-twitter"></i>
        </a></li>
    </ul>
    <div class="footer-back-button">
        <a href="index.html">
            <img src="assets/chbackbuttonred.png" alt="Back to Home">
        </a>
    </div>
    <button id="theme-toggle" type="button">Toggle Theme</button>
    <p>Background music "background music.mp3" by ZHRØ -- <a href="https://freesound.org/s/544416/" target="_blank">Link</a> -- License: Attribution 4.0</p>
    <p style="margin-top: 16px; font-size: 16px;">© 2025 CharlestonHacks. All rights reserved.</p>
</footer>
<audio id="background-music" autoplay loop>
    <source src="assets/music.mp3" type="audio/mp3">
    Your browser does not support the audio element.
</audio>
<audio id="victory-sound" src="assets/chime.mp3" preload="auto"></audio>

<script>
(function () {
    const characters = ['astrid', 'medusa', 'alexandor', 'aegis', 'descartes', 'elara', 'wolf', 'hermes', 'merlin', 'mystery'];
    const backstories = {
        'astrid': 'Astrid - A Valkyrie: A powerful warrior with a destiny to save her people.',
        'medusa': 'Medusa - An Otherworldly Force: A feared and misunderstood god with a powerful gaze.',
        'alexandor': 'Alexandor - The Strategist: A master tactician who leads armies to victory.',
        'aegis': 'Aegis - The Protector: A shield bearer sworn to guard the realms.',
        'descartes': 'Descartes - A Gentleman: Architect with a grand plan.',
        'elara': 'Elara - The Guardian: A watchful protector who stands in the shadows.',
        'wolf': 'Wolf - A loyal, powerful ally: Fierce protector of those he cares about.',
        'merlin': 'Merlin - The Master: Keeper of the hidden truths behind all things.',
        'hermes': 'Hermes - The Humanitarian: An honorable and generous god who thinks of others before himself.',
        'mystery': '? - A Mystery: Waiting to be discovered.'
    };

    const gameContainer = document.getElementById('game-container');
    const backstoryContainer = document.getElementById('backstory');
    const timerDisplay = document.getElementById('timer');
    const movesDisplay = document.getElementById('moves');
    const themeToggle = document.getElementById('theme-toggle');
    const videoContainer = document.getElementById('video-container');
    const video = document.getElementById('video');
    const videoSource = document.getElementById('video-source');
    const closeVideoButton = document.getElementById('close-video');
    const backgroundMusic = document.getElementById('background-music');
    const victoryModal = document.getElementById('victory-modal');
    const victoryMessage = document.getElementById('victory-message');
    const playAgainBtn = document.getElementById('play-again-btn');
    const profilesBtn = document.getElementById('profiles-btn');
    const modalCloseBtn = document.getElementById('modal-close-btn');
    if (backgroundMusic) backgroundMusic.volume = 0.5;

    let flippedCards = [];
    let matchedCards = [];
    let timer = 0;
    let moves = 0;
    let intervalId;

    function startTimer() {
        intervalId = setInterval(() => {
            timer++;
            timerDisplay.textContent = `Time: ${timer}s`;
        }, 1000);
    }

    function stopTimer() {
        clearInterval(intervalId);
    }

    function createCards() {
        const cards = [];
        characters.forEach(character => {
            for (let i = 0; i < 2; i++) {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.character = character;
                card.setAttribute('tabindex', '0');
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <img src="images/universalcard-01.png" alt="Front of ${character} card">
                        </div>
                        <div class="card-back">
                            <img src="images/${character.charAt(0).toUpperCase() + character.slice(1)}.png" alt="${character} character">
                        </div>
                    </div>
                `;
                cards.push(card);
            }
        });
        return cards;
    }

    function shuffleCards() {
        const cards = createCards();
        cards.sort(() => Math.random() - 0.5);
        gameContainer.innerHTML = '';
        cards.forEach(card => gameContainer.appendChild(card));
    }

    function playVideo(character) {
        if (character === 'descartes') {
            videoSource.src = 'images/Descartesvideo.mp4';
        } else if (character === 'medusa') {
            videoSource.src = 'images/Medusavideo.mp4';
        } else if (character === 'alexandor') {
            videoSource.src = 'images/Alexandorvideo.mp4';
        } else if (character === 'elara') {
            videoSource.src = 'images/Elaravideo.mp4'; 
        } else if (character === 'astrid') {
            videoSource.src = 'images/astridvideo.mp4'; 
        } else if (character === 'aegis') {
            videoSource.src = 'images/aegisvideo.mp4'; 
        } else if (character === 'wolf') {
            videoSource.src = 'images/wolfvideo.mp4';
        } else if (character === 'merlin') {
            videoSource.src = 'images/merlin.mp4';
        } else if (character === 'hermes') {
            videoSource.src = 'images/hermesvideo.mp4';
        } else if (character === 'mystery') {
            videoSource.src = 'images/Mystery.mp4'; 
        }
        video.load();
        videoContainer.style.display = 'block';
        video.play();
        video.onended = () => {
            videoContainer.style.display = 'none';
        };
    }

    closeVideoButton.addEventListener('click', () => {
        videoContainer.style.display = 'none';
        video.pause();
    });

    function showVictoryModal() {
        victoryMessage.textContent = `You win! Time: ${timer}s, Moves: ${moves}`;
        victoryModal.classList.add('active');
        profilesBtn.focus();
    }

    function hideVictoryModal() {
        victoryModal.classList.remove('active');
    }

    function checkMatch() {
        const [firstCard, secondCard] = flippedCards;
        if (firstCard.dataset.character === secondCard.dataset.character) {
            matchedCards.push(firstCard, secondCard);
            backstoryContainer.textContent = backstories[firstCard.dataset.character];
            backstoryContainer.style.display = 'block';
            firstCard.classList.add('matched');
            secondCard.classList.add('matched');
            flippedCards = [];

            if (matchedCards.length === characters.length * 2) {
                stopTimer();
                setTimeout(() => {
                    document.getElementById('victory-sound').play();
                    showVictoryModal();
                }, 500);
            }

            if (
                firstCard.dataset.character === 'descartes' ||
                firstCard.dataset.character === 'medusa' ||
                firstCard.dataset.character === 'alexandor' ||
                firstCard.dataset.character === 'elara' ||
                firstCard.dataset.character === 'astrid' ||
                firstCard.dataset.character === 'wolf' ||
                firstCard.dataset.character === 'merlin' ||
                firstCard.dataset.character === 'hermes' ||
                 firstCard.dataset.character === 'mystery' ||
                firstCard.dataset.character === 'aegis'
            ) {
                playVideo(firstCard.dataset.character);
            }

        } else {
            setTimeout(() => {
                firstCard.classList.remove('flipped');
                secondCard.classList.remove('flipped');
                flippedCards = [];
            }, 1000);
        }
    }

    function hideBackstory() {
        backstoryContainer.style.display = 'none';
    }

    gameContainer.addEventListener('click', (e) => {
        const card = e.target.closest('.card');
        if (!card || card.classList.contains('flipped') || flippedCards.length >= 2) return;

        hideBackstory();

        card.classList.add('flipped');
        flippedCards.push(card);
        moves++;
        movesDisplay.textContent = `Moves: ${moves}`;

        if (flippedCards.length === 2) checkMatch();
    });

    gameContainer.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            const card = document.activeElement;
            if (card && card.classList.contains('card') && !card.classList.contains('flipped')) {
                card.classList.add('flipped');
                flippedCards.push(card);
                moves++;
                movesDisplay.textContent = `Moves: ${moves}`;

                if (flippedCards.length === 2) checkMatch();
            }
        }
    });

    // Play Again functionality
    playAgainBtn.addEventListener('click', () => {
        hideVictoryModal();
        matchedCards = [];
        flippedCards = [];
        timer = 0;
        moves = 0;
        timerDisplay.textContent = 'Time: 0s';
        movesDisplay.textContent = 'Moves: 0';
        backstoryContainer.style.display = 'none';
        shuffleCards();
        stopTimer();
        startTimer();

        backgroundMusic.currentTime = 0;
        backgroundMusic.play();
    });

    // Modal close button (also closes on ESC)
    modalCloseBtn.addEventListener('click', hideVictoryModal);
    window.addEventListener('keydown', function(e) {
        if (victoryModal.classList.contains('active') && (e.key === "Escape" || e.key === "Esc")) {
            hideVictoryModal();
        }
    });

    // Profiles button
    profilesBtn.addEventListener('click', function() {
        window.location.href = 'profiles.html';
    });

    // Restart the game when the logo is clicked
    document.getElementById('logo').addEventListener('click', () => {
        hideVictoryModal();
        matchedCards = [];
        flippedCards = [];
        timer = 0;
        moves = 0;
        timerDisplay.textContent = 'Time: 0s';
        movesDisplay.textContent = 'Moves: 0';
        backstoryContainer.style.display = 'none';
        shuffleCards();
        stopTimer();
        startTimer();

        backgroundMusic.currentTime = 0;
        backgroundMusic.play();
    });

    themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('light-theme');
        document.body.style.backgroundColor = document.body.classList.contains('light-theme') ? 'white' : 'black';
        document.body.style.color = document.body.classList.contains('light-theme') ? 'black' : 'white';
        document.querySelectorAll('.card').forEach(card => {
            card.classList.toggle('light-theme');
        });
    });

    shuffleCards();
    startTimer();
})();
</script>
</body>
</html>
